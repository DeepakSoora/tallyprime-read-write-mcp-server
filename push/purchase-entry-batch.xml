<?xml version="1.0" encoding="utf-8"?>
<ENVELOPE>
    <HEADER>
        <VERSION>1</VERSION>
        <TALLYREQUEST>Import</TALLYREQUEST>
        <TYPE>Data</TYPE>
        <ID>Vouchers</ID>
    </HEADER>
    <BODY>
        <DESC>
            <STATICVARIABLES>
                <nunjuck>if targetCompany</nunjuck>
                <SVCURRENTCOMPANY>{{targetCompany | escape}}</SVCURRENTCOMPANY>
                <nunjuck>endif</nunjuck>
            </STATICVARIABLES>
        </DESC>
        <DATA>
            <TALLYMESSAGE xmlns:UDF="TallyUDF">
                <nunjuck>for voucher in vouchers</nunjuck>
                <VOUCHER VCHTYPE="Purchase" ACTION="Create">
                    <DATE>{{voucher.date}}</DATE>
                    <nunjuck>if voucher.voucherNumber</nunjuck>
                    <VOUCHERNUMBER>{{voucher.voucherNumber | escape}}</VOUCHERNUMBER>
                    <nunjuck>endif</nunjuck>
                    <VOUCHERTYPENAME>Purchase</VOUCHERTYPENAME>
                    <PARTYLEDGERNAME>{{voucher.supplierLedger | escape}}</PARTYLEDGERNAME>
                    <nunjuck>if voucher.narration</nunjuck>
                    <NARRATION>{{voucher.narration | escape}}</NARRATION>
                    <nunjuck>endif</nunjuck>
                    <nunjuck>if voucher.mode == "invoice"</nunjuck>
                    <ISINVOICE>Yes</ISINVOICE>
                    <nunjuck>endif</nunjuck>

                    <nunjuck>if voucher.mode == "accounting"</nunjuck>
                    <ALLLEDGERENTRIES.LIST>
                        <LEDGERNAME>{{voucher.purchaseLedger | escape}}</LEDGERNAME>
                        <ISDEEMEDPOSITIVE>Yes</ISDEEMEDPOSITIVE>
                        <AMOUNT>-{{voucher.totalAmount}}</AMOUNT>
                    </ALLLEDGERENTRIES.LIST>
                    <ALLLEDGERENTRIES.LIST>
                        <LEDGERNAME>{{voucher.supplierLedger | escape}}</LEDGERNAME>
                        <ISDEEMEDPOSITIVE>No</ISDEEMEDPOSITIVE>
                        <AMOUNT>{{voucher.totalAmount}}</AMOUNT>
                    </ALLLEDGERENTRIES.LIST>
                    <nunjuck>endif</nunjuck>

                    <nunjuck>if voucher.mode == "invoice"</nunjuck>
                    <nunjuck>for item in voucher.inventoryEntries</nunjuck>
                    <ALLINVENTORYENTRIES.LIST>
                        <STOCKITEMNAME>{{item.stockItemName | escape}}</STOCKITEMNAME>
                        <ISDEEMEDPOSITIVE>Yes</ISDEEMEDPOSITIVE>
                        <RATE>{{item.rate}}/{{item.unit | escape}}</RATE>
                        <AMOUNT>-{{item.quantity * item.rate}}</AMOUNT>
                        <ACTUALQTY>{{item.quantity}} {{item.unit | escape}}</ACTUALQTY>
                        <BILLEDQTY>{{item.quantity}} {{item.unit | escape}}</BILLEDQTY>
                        <ACCOUNTINGALLOCATIONS.LIST>
                            <LEDGERNAME>{{voucher.purchaseLedger | escape}}</LEDGERNAME>
                            <ISDEEMEDPOSITIVE>Yes</ISDEEMEDPOSITIVE>
                            <AMOUNT>-{{item.quantity * item.rate}}</AMOUNT>
                        </ACCOUNTINGALLOCATIONS.LIST>
                    </ALLINVENTORYENTRIES.LIST>
                    <nunjuck>endfor</nunjuck>

                    <LEDGERENTRIES.LIST>
                        <LEDGERNAME>{{voucher.supplierLedger | escape}}</LEDGERNAME>
                        <ISDEEMEDPOSITIVE>No</ISDEEMEDPOSITIVE>
                        <AMOUNT>{{voucher.invoiceTotal}}</AMOUNT>
                    </LEDGERENTRIES.LIST>

                    <nunjuck>for entry in voucher.ledgerEntries</nunjuck>
                    <LEDGERENTRIES.LIST>
                        <LEDGERNAME>{{entry.ledgerName | escape}}</LEDGERNAME>
                        <ISDEEMEDPOSITIVE>Yes</ISDEEMEDPOSITIVE>
                        <AMOUNT>-{{entry.amount}}</AMOUNT>
                    </LEDGERENTRIES.LIST>
                    <nunjuck>endfor</nunjuck>
                    <nunjuck>endif</nunjuck>
                </VOUCHER>
                <nunjuck>endfor</nunjuck>
            </TALLYMESSAGE>
        </DATA>
    </BODY>
</ENVELOPE>
